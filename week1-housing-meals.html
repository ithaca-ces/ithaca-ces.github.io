<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>Suzuki Institutes Registration</title>
    <style>
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            opacity: 1;
        }
    </style>
</head>
<body>
<div id="pre" class="container"><br><br><br><br><center><i style="font-size: 8em" class="fas fa-sync fa-spin"></i></center></div>
<div  id="container" class="container" style="display:none;visibility:hidden">
    <br>
    <h2>Select & Purchase Week 1 Housing & Meals</h2>
    <hr>

    <h3>Provide your personal & contact information:</h3>
    <br>
    <div class="form-row">
        <div class="form-group col-md-6">
            <label for="inputFirstName">First Name:</label>
            <input type="text" class="form-control" id="inputFirstName">
        </div>
        <div class="form-group col-md-6">
            <label for="inputLastName">Last Name:</label>
            <input type="text" class="form-control" id="inputLastName" >
        </div>
    </div>
    <div class="form-group">
        <label for="inputAddress">Address:</label>
        <input type="text" class="form-control" id="inputAddress">
    </div>
    <div class="form-row">
        <div class="form-group col-md-6">
            <label for="inputCity">City:</label>
            <input type="text" class="form-control" id="inputCity">
        </div>
        <div class="form-group col-md-4">
            <label for="inputState">State:</label>
            <select id="inputState" class="form-control">
                <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <option value="AR">Arkansas</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DE">Delaware</option>
                <option value="DC">District Of Columbia</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="IA">Iowa</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="ME">Maine</option>
                <option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MS">Mississippi</option>
                <option value="MO">Missouri</option>
                <option value="MT">Montana</option>
                <option value="NE">Nebraska</option>
                <option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option selected value="NY">New York</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VT">Vermont</option>
                <option value="VA">Virginia</option>
                <option value="WA">Washington</option>
                <option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option>
                <option value="WY">Wyoming</option>
            </select>
        </div>
        <div class="form-group col-md-2">
            <label for="inputZip">Zip:</label>
            <input type="text" class="form-control" id="inputZip">
        </div>
    </div>
    <div class="form-group">
        <label for="inputPhoneNumber">Phone Number:</label>
        <input type="text" class="form-control" id="inputPhoneNumber">
    </div>
    <div class="form-group">
        <label for="inputEmailAddress">Email Address:</label>
        <input type="text" class="form-control" id="inputEmailAddress">
    </div>

    <hr>
    <h3>Meal Plans</h3>
    <p>BLURB ABOUT MEAL PLANS</p>
    <p>A meal plan costs $<span id="mealPrice"></span>.</p>
    <div class="form-group form-inline ">
        <label for="inputMealPlanCount">Number Of Meal Plans:</label> &nbsp;&nbsp;
        <input style="max-width: 400px" min="0" type="number" class="form-control" id="inputMealPlanCount" value="0">
    </div>

    <hr>
    <h3>Housing</h3>
    <p>BLURB ABOUT HOUSING</p>
    <div id="housingInputs">

    </div>
    <div id="housingList" style="visibility: hidden; display: none"></div>
    <div id="nameList" style="visibility: hidden; display: none"></div>
    <div id="priceList" style="visibility: hidden; display: none"></div>

    <hr>

    <button onclick="submit()" class="btn btn-success">Continue To Payment</button>
    <br><br>

    <div id="paymentFormDiv" style="visibility: hidden; display: none">
        <form target="_parent" id="payform" method="post" action="https://shoppingcartsecure.com/cart32.exe/6072743313-AddItem">
            <div id="payFormInputs" style="visibility: hidden; display: none"></div>
        </form>
    </div>

</div>
<div id="hidden" style="display: none; visibility: hidden;"></div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    // meal data
    $.get("https://docs.google.com/spreadsheets/d/e/2PACX-1vRmvtTepOd7KLF6QYjegI-wsp-ZDAuT-JOaykqhScyUEbS731qerv_AM6SNIQX84Evz_VtLut66rxGb/pubhtml?gid=1223661694&single=true",
        function(data, status) {
        document.getElementById("mealPrice").innerText = getTableData(data)[1][1];
    });
    $.get("https://docs.google.com/spreadsheets/d/e/2PACX-1vRmvtTepOd7KLF6QYjegI-wsp-ZDAuT-JOaykqhScyUEbS731qerv_AM6SNIQX84Evz_VtLut66rxGb/pubhtml?gid=256271385&single=true",
        function(data, status) {
            var housingData = getTableData(data);
            var housingInputs = "";
            var housingList = "";
            var nameList = "";
            var priceList = "";
            for (var i = 1; i < housingData.length; i++) {
                housingList += housingData[i][0].toLowerCase().replace(/ /g, '') + ";;;";
                nameList += housingData[i][0] + ";;;";
                priceList += housingData[i][1] + ";;;";
                if (parseInt(housingData[i][4]) > 0) {
                    var firstLine = "<div class=\"form-group\">";
                    var secondLine = "<label for=\"input" + housingData[i][0].toLowerCase().replace(/ /g, '') + "\">" + housingData[i][0] + " - $" + housingData[i][1] + "</label> &nbsp;&nbsp;";
                    var thirdLine = "<input style=\"max-width: 400px\" type=\"number\" min=\"0\" max=\"" + housingData[i][4] + "\" class=\"form-control\" value='0' id=\"input" + housingData[i][0].toLowerCase().replace(/ /g, '') + "\">";
                    var fourthLine = "<small id=\"emailHelp\" class=\"form-text text-muted\">" + housingData[i][4] + " remaining </small>";
                    var fifthLine = "</div>";
                    housingInputs += firstLine + secondLine + thirdLine + fourthLine + fifthLine;
                }
            }
            document.getElementById("housingInputs").innerHTML = housingInputs;
            document.getElementById("housingList").innerText = housingList;
            document.getElementById("nameList").innerText = nameList;
            document.getElementById("priceList").innerText = priceList;
        })

        $( document ).ajaxComplete(function() {
            document.getElementById("container").style.display = "inherit";
            document.getElementById("container").style.visibility = "visible";
            document.getElementById("pre").style.display = "none";
            document.getElementById("pre").style.visibility = "hidden";
        })


    function getTableData(inputData) {
        var array1 = inputData.toString().split("<table");
        var array2 = array1[1].split("</table>");
        var string = "<table" + array2[0] + "</table>";
        document.getElementById("hidden").innerHTML = string;
        var myTableArray = [];
        $("table tr").each(function() {
            var arrayOfThisRow = [];
            var tableData = $(this).find('td');
            if (tableData.length > 0) {
                tableData.each(function() { arrayOfThisRow.push($(this).text()); });
                myTableArray.push(arrayOfThisRow);
            }
        });
        return myTableArray;
    }

    function getSelectData(name) {
        var e = document.getElementById(name);
        var value = e.options[e.selectedIndex].value;
        return value;
    }

    function submit() {
        document.getElementById("container").style.display = "none";
        document.getElementById("container").style.visibility = "hidden";
        document.getElementById("pre").style.display = "inherit";
        document.getElementById("pre").style.visibility = "visible";
        submitGoogleForm();
        submitPaymentForm();
    }

    function submitGoogleForm() {
        var housingString = document.getElementById("housingList").innerText;
        var housingList = housingString.split(";;;");
        var dataArray = "";
        for (var i = 0; i < housingList.length - 1; i ++) {
            dataArray += document.getElementById("input" + housingList[i]).value + ";;;";
        }
        // get the form data
        // there are many ways to get this data using jQuery (you can use the class or id also)
        var formData = {
            'entry.2039036389': $('input[id=inputFirstName]').val(),
            'entry.305040084': $('input[id=inputLastName]').val(),
            'entry.1583950870': $('input[id=inputAddress]').val(),
            'entry.1741944776': $('input[id=inputCity]').val(),
            'entry.1449597621': getSelectData("inputState"),
            'entry.2043889500': $('input[id=inputZip]').val(),
            'entry.1770398499': $('input[id=inputPhoneNumber]').val(),
            'entry.303292725': $('input[id=inputEmailAddress]').val(),
            'entry.975589451': $('input[id=inputMealPlanCount]').val(),
            'entry.616708405': dataArray
        }
        // process the form
        $.ajax({
            type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
            url         : 'https://docs.google.com/forms/d/e/1FAIpQLSdrotzMctO4vAOOtdsr16hHvL05yOif2tVb8Pgb8STiFlJHdQ/formResponse', // the url where we want to POST
            data        : formData, // our data object
            dataType    : 'json', // what type of data do we expect back from the server
            encode          : true
        })
        // using the done promise callback
            .done(function(data) {
                // log data to the console so we can see
                console.log(data);
                // here we will handle errors and validation messages
            });
    }

    function submitPaymentForm() {
        var formInputs = "";

        var mealPlanCount = parseInt(document.getElementById("inputMealPlanCount").value);
        if (mealPlanCount > 0) {
            var line0 = "<div id=\"" + "meal_plan" + "\">";
            var line1 = "<input type=\"hidden\" name=\"PartNo\" value=\"" + "Meal Plan" + "\">";
            var line2 = "<input type=\"hidden\" name=\"Item\" value=\"" + "Meal Plan" + "\">";
            var line3 = "<input id=\"qty_meal_plan\" type=\"hidden\" name=\"Qty\" value=" + mealPlanCount + ">";
            var line4 = "<input type=\"hidden\" name=\"Price\" value=" + document.getElementById("mealPrice").innerText + ">";
            var line5 = "</div>";
            formInputs = line0 + line1 + line2 + line3 + line4 + line5;
        }

        var housingString = document.getElementById("housingList").innerText;
        var housingList = housingString.split(";;;");
        var nameString = document.getElementById("nameList").innerText;
        var nameList = nameString.split(";;;");
        var priceString = document.getElementById("priceList").innerText;
        var priceList = priceString.split(";;;");
        for (var i = 0; i < housingList.length - 1; i ++) {
            if (document.getElementById("input" + housingList[i]) != null) {
                var count = parseInt(document.getElementById("input" + housingList[i]).value);
                if (count > 0) {
                    var line0 = "<div id=\"" + housingList[i] + "\">";
                    var line1 = "<input type=\"hidden\" name=\"PartNo\" value=\"" + nameList[i] + "\">";
                    var line2 = "<input type=\"hidden\" name=\"Item\" value=\"" + nameList[i] + "\">";
                    var line3 = "<input id=\"qty_" + housingList[i] + "\" type=\"hidden\" name=\"Qty\" value=" + count + ">";
                    var line4 = "<input type=\"hidden\" name=\"Price\" value=" + priceList[i] + ">";
                    var line5 = "</div>";
                    formInputs += line0 + line1 + line2 + line3 + line4 + line5;
                }
            }
        }
        document.getElementById("payFormInputs").innerHTML = formInputs;
        document.getElementById("payform").submit();
    }

</script>
</body>
</html>
